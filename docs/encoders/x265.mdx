---
title: x265
sidebar_position: 2
---

# x265

x265 is a software library and command line application for encoding [H.265 / HEVC](../video/HEVC.mdx) developed by MulticoreWare, written in C++ and x86 assembly, and released in 2013.

By default, x265 is tuned for low-bitrate content due to the blurring filters it applies. However, it can be tuned using CLI options to be very effective for high-fidelity content as well.
It is a more efficient and modern encoder compared to x264, and is currently a popular choice for both high-fidelity and mini encodes.

x265 is currently not recommended for lossless encoding. For that niche, x264 is considerably faster without meaningful efficiency loss.

## FFmpeg

x265 is available in FFmpeg via `libx265`, to check if you have it, run `ffmpeg -h encoder=libx265`.

## Suggested settings for high quality HD film encoding
The x265 defaults and presets include some settings that are counterproductive for high quality encoding, so it is hard to get a high quality and efficient encode out of x265. That said, with careful tuning it is possible to beat x264 in grain handling, detail preservation and compression efficiency. Some suggested settings include:

`--preset slow --aq-mode 1 --qg-size 8 --pbratio 1.2 --no-sao --ctu 32`

For ffmpeg: `-preset slow -x265-params aq-mode=1:qg-size=8:pbratio=1.2:sao=0:ctu=32`

These settings focus on detail preservation and graceful grain handling (but not grain preservation at all costs). Each option is explained below

### --preset slow
Preset `slow` has a good balance of speed and quality. It is only 2x to 3x as slow as x264's preset slower. Preset `slower` is more than twice as slow as `slow`, and presets `slower` and higher include options that attempt to increase sharpenss at the cost of more roughness and more artifacts. The artifacts and roughness force you to increase bitrate until you may as well go back to x264. The biggest culprit of `slower` producing worse quality than `slow` are:

#### --rd 4 &rarr; --rd 6
--rd 6 interacts badly with psy-rd and it is responsible for the directional prediction artifacts ("microbanding") that plague the higher presets. The reason is that --rd 6 uses the full RDO metric including psy-rd to choose the intra mode in P and B frames, whereas --rd 4 only uses SAD (sum of absolute differences) to choose the intra mode in P and B frames. [1] Using psy-rd to select the intra mode can cause the encoder to favour variance matching over minimizing error, which produces distinctive directional prediction artifacts from naked directional intra predictions at low bitrates. When psy-rd is not used, --rd 6 is better than --rd 4, but when psy-rd is used, --rd 6 can produce results that defy common sense.

Image comparison: 1. [--rd 4](/img/x265-rd4.webp), 2. [--rd 6](/img/x265-rd6.webp). All other settings equal. --rd 6 had slightly higher bitrate. Notice the microbanding on the man's chin in the --rd 6 version.

[1] code reference: compressInterCU_rd5_6 calls checkIntra while compressInterCU_rd0_4 calls checkIntraInInter.

#### --bframes 4 &rarr; --bframes 8
x265 only supports 2 level b pyramid, so a mini-GOP looks like this: PbbbBbbbP. In this example there are 7 b frames. The middle B frame is at the first pyramid level and it uses the P frames as reference. The other b frames are at the second pyramid level and they use the P and B frames as reference. Increasing the --bframes setting has two effects:
1. It increases the distance between high quality frames (P and B).
2. It causes cutree (mbtree) to boost the quality of the referenced frames (P and B) even more because there are more b frames using the P and B frames as reference, increasing the quality difference between the P/B frames and the b frames.

Both of these cause bad grain handling because they increase the chance of grain pulsing and sticky grain, where the grain is only encoded/updated in the P and B frames and the b frames will motion-compensate the grain along with the moving objects, keep the grain stationary without updating them, or lose the grain altogether.

### --aq-mode 1
AQ mode 1 is the simplest and most reliable of the AQ modes, and it is the same as x264's AQ mode 1. In AQ mode 1, a block's QP offset depends on the block's own variance and nothing else. The other AQ modes try to be clever but end up being harder to understand and less consistent. In my testing, AQ mode 1 produced less blur in dark areas than AQ modes 2 and 3. AQ mode 1 is x264's default.

### --qg-size 8
--qg-size sets the spatial resolution of AQ. For example, the default --qg-size 32 means QP adjustment is done for every 32x32 group of pixels. 32x32 may be ok for 4K but it's too big for HD, so it will cause grainless halos to appear around sharp edges, especially if you raise AQ strength. --qg-size 8 eliminates this artifact.

### --pbratio 1.2
pbratio sets the QP offset between pyramid levels and the default is 1.3. In x265, the fixed QP offset between pyramid levels and the QP offset from cutree are added together. This is unlike x264 where mbtree replaces pbratio (forces it to 1). Here we reduce pbratio slightly to reduce grain pulsing, sticky grain and temporal non-uniformity in general. Note that reducing pbratio can reduce compression efficiency at low bitrates, which is why x265 does not disable pbratio when cutree is enabled.

### --no-sao
SAO is a spatial denoise filter introduced in HEVC that's meant to remove DCT noise, but it is heavy-handed and causes a lot of blur. The blur may be beneficial for animated content, but it is very counterproductive for everything else. Even at low-ish bitrates, it can do more damage than good.

### --ctu 32
This is somewhat of a performance optimization. At HD resolutions, the number of CTU rows is too low for WPP to fully utilize today's high core count processors. By reducing the CTU size (max block size) from 64x64 to 32x32, the number of threads that can be utilized is doubled. For 4K, 64x64 blocks help with compression efficiency but for high quality HD it's not important because large blocks are mostly useful for smooth gradients, which high quality encodes shouldn't have a lot of. If anything, limiting the block size also limits the size of artifacts when the enocder makes a mistake.

## Other interesting settings

### --rdoq-level 0 --psy-rdoq 0

Note: --psy-rdoq 0 is implied by --rdoq-level 0. I'm only listing it here to be more explicit.

Disabling RDOQ makes x265 behave more like x264. At lower bitrates, the picture gets softer instead of rougher and artifacts are less in-your-face. Grain gets spottier but more consistent from frame to frame, which is similar to how x264 handles grain at lower bitrates. The downside of disabling RDOQ is less sharpness and less detail preservation. These settings may be useful at lower bitrates where the default RDOQ settings produce roughness and pulsing grain.

## Installation

**Pre-built binary (Recommended):**

- http://msystem.waw.pl/x265/

## Parameters

This section will overview the most important parameters for controlling output and quality in x265. The parameters will be listed in the format used by the standalone x265 binary,
but all of the parameters should also be usable in ffmpeg in the format e.g. `-x265-params pass=1`.

### Preset

`--preset slow`

If encoding speed is a priority, x265 is probably not the best choice. x264 at `--preset veryslow` will likely be faster than x265 at `--preset fast`, while providing comparable efficiency.
However, x265 finds its sweet spot at `--preset slow`, and this is the preset most people should use. This preset provides high quality while not being unreasonably slow.

The exception where you may want to tax your CPU by going to `--preset veryslow` is when doing lower bitrate encodes (e.g. crf >=22). This is because the `veryslow` preset provides
better motion estimation at low bitrates. However, it is exceptionally slow, so it is not generally recommended for everyday use.

### CRF

`--crf`

CRF, standing for Constant Rate Factor, is a method for selecting a level of quality-to-filesize tradeoff. CRF is preferable to bitrate targeting because CRF only requires one encoding pass,
so bitrate targeting should only be used if you need to target a specific filesize. Nowadays, those situations are uncommon and it is preferred to use CRF to target a quality level.
CRF is preferable to QP because CRF allows the encoder to vary the quality level from frame to frame for better viewing quality in areas of the video that need it the most.

What CRF to use will vary depending on your goals. The range of valid CRF values is 0-51, with larger values providing smaller filesize but lower quality. Some amount of experimentation
may be needed to find the value you prefer. A decent "balanced" target will be around 17 or 18, providing good quality without inflating filesize too much. For a focus on maximum quality,
a value of 12 or 13 will result in visually lossless output for most videos, but will result in a much larger filesize. For miniature encodes, try raising the CRF as much as you feel comfortable
before the quality becomes unbearable. CRFs of 22 or higher are generally considered "low bitrate", so how high you raise the CRF depends on how low of a filesize you are trying to achieve.

### bframes

`--bframes`

B-frames are bi-directional predictive frames, this means that they can reference frames both before and after themselves, which makes them very efficient.
The `--bframes` parameter controls how many B-frames can be used consecutively. Higher values can result in better compression, but this value has diminishing returns,
as the encoder won't use extra B-frames in situations where it would reduce efficiency.

The default value at preset slow is `4`. It is recommended to increase this to `--bframes 5` for live action and CGI content, or `--bframes 8` for anime and cartoons.
Content with little motion benefits more from high B-frames values, but even on anime where there are many still scenes, there is no measurable benefit
to using a value higher than `8`, and it would just slow down the encoder for no benefit.

### SAO

`--sao`, `--limit-sao`, `--no-sao`

SAO stands for Sample Adaptive Offset, and is a loop filter used by x265 to prevent artifacting. However, it has the side effect of losing sharpness on details.
It is recommended to leave this on (default) at high CRF values (>=22). For medium values between 17-21, you can use `--limit-sao` which will limit the effects of SAO to have
less of a significant effect. For low CRF values (\<=16), you can safely use `--no-sao` to prefer detail preservation, as the higher bitrates will naturally lead to fewer artifacts.

### Deblock

`--deblock`

Deblock is another loop filter, this one intended to reduce blocking in videos, but may have a blurring effect at high strengths. For most encodes, it is fine to leave this
at the default value. At lower CRF values, it may be desirable to lower this to `--deblock -1:-1` for anime or `--deblock -2:-2` for live action, in order to preserve
more grain and detail.

### Psy-RD

`--psy-rd` and `--psy-rdoq`

The parameters control psychovisual rate distribution. What this means is the redistribution of bits to make a video more pleasing to human eyes. These options may be harmful to metrics
that compare videos mathematically, but are better for viewing human eyes because they prioritize facets of the video that humans prefer.

`--psy-rd` biases toward matching the level of energy in the source image, which makes it good for retaining detail. For standard anime, it is recommended to use `--psy-rd 1.0`. The more
grain, detail, and dark scenes in a source, the higher this should be raised. Many modern anime tends to have more detailed backgrounds and surfaces, so `--psy-rd 1.5` may be a better
default for modern anime. For live action, a `--psy-rd 1.5` or possibly even `2.0` may be preferred, as live action naturally has more detail and grain than anime.

`--psy-rdoq` biases toward energy in general, which makes it key for preserving grain. `--psy-rdoq 1.0` is a safe default for anime. Like psy-rd, this value should be increased more
for sources with more grain. For grainy anime, `--psy-rdoq 2.0` or even `3.0` can be preferable. Likewise, for many live action series, a default of `--psy-rdoq 3.0` can be preferable,
or even `4.0` with heavy grain.

These are two settings that should be tweaked according to the source material.

You can read more about the importance of perceptual optimization in video encoders on the [psychovisual](../introduction/psychovisual.mdx) page.

### Adaptive Quantization

`--aq-mode 3 --aq-strength <variable>`

Adaptive quantization, shortened to AQ, is a mechanism to redistribute bitrate within a frame to improve visual quality by reducing artifacts.
x265 has several different AQ modes, and `--aq-mode 3` is nearly always best, because this mode adds a bias favoring dark scenes, which greatly reduces the effects of banding and blocking.
The strength of AQ can also be set with `--aq-strength`. The optimal setting for this may vary depending on the type of content you are encoding.
For anime, `--aq-strength 0.7` will typically produce good results. For live action, a slightly higher `0.8` may be a better default.
Higher values, up to `--aq-strength 1`, can be helpful for sources with heavy grain, although this will also increase overall bitrate.

### CU-Tree

`--no-cutree`

CU-Tree is a mechanism very similar to MB-Tree in x264, which is intended to redistribute bitrate in a more optimal psychovisual manner. However, many people find CU-Tree to be harmful to quality,
especially when attempting to encode videos with considerable amounts of grain, and therefore many people recommend disabling this with `--no-cutree`.
